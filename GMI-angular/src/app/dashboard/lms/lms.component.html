<div class="trezo-card bg-white dark:bg-[#0c1427] mb-[25px] p-[20px] md:p-[25px] rounded-md">
    <div class="trezo-card-header mb-[20px] md:mb-[25px] sm:flex items-center justify-between">
        <div class="trezo-card-title">
            <h5 class="mb-0">Interventions</h5>
        </div>
        <div class="trezo-card-subtitle mt-[10px] sm:mt-0 flex flex-col sm:flex-row items-center gap-3">
            <input type="text" [(ngModel)]="searchText" placeholder="Rechercher une intervention..." 
                   class="border border-gray-300 dark:border-[#172036] rounded-md px-3 py-2 w-full sm:w-auto dark:bg-[#0c1427] dark:text-white" />
            <button type="button" class="rounded-md inline-block transition-all py-[3.5px] px-[17px] border border-gray-100 dark:border-[#172036] hover:border-primary-500 hover:bg-primary-500 hover:text-white" 
                    (click)="openModalAdd()">
                <i class="ri-add-line text-xl"></i> Ajouter
            </button>
        </div>
    </div>

    <div class="trezo-card-content">
        <div class="table-responsive overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Titre</th>
                        <th>Statut</th>
                        <th>Client</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody class="text-black dark:text-white">
                    <tr *ngFor="let intervention of filteredInterventions">
                        <td>{{ intervention.type }}</td>
                        <td>{{ intervention.datedecreation | date:'shortDate' }}</td>
                        <td>{{ intervention.titre }}</td>
                        <td>{{ intervention.statut }}</td>
                        <td>{{ intervention.demandeur.email }}</td>
                        <td>{{ intervention.description }}</td>
                        <td>
                            <button class="text-blue-500 hover:text-blue-700" (click)="editIntervention(intervention)">
                                <i class="ri-pencil-line"></i> Modifier
                            </button>
                            <button class="text-red-500 hover:text-red-700" (click)="confirmDelete(intervention)">
                                <i class="ri-delete-bin-line"></i> Archiver
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal d'ajout d'une intervention -->
<div *ngIf="showModalAdd" class="modal-overlay">
    <div class="modal-content">
        <span class="close" (click)="closeModalAdd()">&times;</span>
        <h2>Ajouter une intervention</h2>
        <form (ngSubmit)="addIntervention()">
            <div>
                <label>Titre</label>
                <input type="text" [(ngModel)]="newIntervention.titre" name="titre" placeholder="Titre de l'intervention" required />
            </div>

            <div>
                <label>Type</label>
                <select [(ngModel)]="newIntervention.type" name="type" required>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Installation">Installation</option>
                    <option value="Support">Support</option>
                </select>
            </div>

            <div>
                <label>Priorité</label>
                <select [(ngModel)]="newIntervention.priorite" name="priorite" required>
                    <option value="Basse">Basse</option>
                    <option value="Moyenne">Moyenne</option>
                    <option value="Haute">Haute</option>
                </select>
            </div>

            <div>
                <label>Statut</label>
                <select [(ngModel)]="newIntervention.statut" name="statut" required>
                    <option value="Prévue">Prévue</option>
                    <option value="En cours">En cours</option>
                    <option value="Terminée">Terminée</option>
                    <option value="Annulée">Annulée</option>
                </select>
            </div>

            <div>
                <label>Description</label>
                <textarea [(ngModel)]="newIntervention.description" name="description" placeholder="Détails de l’intervention"></textarea>
            </div>

            <!-- Liste des utilisateurs -->
            <div>
                <label>Utilisateur demandeur</label>
                <select [(ngModel)]="newIntervention.demandeur" name="demandeur" required>
                    <option *ngFor="let utilisateur of userList" [ngValue]="utilisateur">{{ utilisateur.nom }} {{ utilisateur.prenom }}</option>
                </select>
            </div>

            <!-- Liste des matériaux -->
            <div>
                <label>Matériaux</label>
                <select [(ngModel)]="newIntervention.materiel" name="materiel" required>
                    <option *ngFor="let materiel of MatList" [ngValue]="materiel">{{ materiel.model }}</option>
                </select>
            </div>

            <button type="submit">Ajouter</button>
            <button type="button" (click)="closeModalAdd()">Annuler</button>
        </form>
    </div>
</div>

<!-- Modal de modification d'une intervention -->
<div *ngIf="showModalEdit" class="modal-overlay">
    <div class="modal-content">
        <span class="close" (click)="closeModalEdit()">&times;</span>
        <h2>Modifier une intervention</h2>
        <form (ngSubmit)="updateIntervention()">
            <div>
                <label>Titre</label>
                <input type="text" [(ngModel)]="selectedIntervention.titre" name="titre" placeholder="Titre de l'intervention" required />
            </div>

            <div>
                <label>Type</label>
                <select [(ngModel)]="selectedIntervention.type" name="type" required>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Installation">Installation</option>
                    <option value="Support">Support</option>
                </select>
            </div>
            <div>
                <label>Priorité</label>
                <select [(ngModel)]="selectedIntervention.priorite" name="priorite" required>
                    <option value="Basse">Basse</option>
                    <option value="Moyenne">Moyenne</option>
                    <option value="Haute">Haute</option>
                </select>
            </div>

            <div>
                <label>Statut</label>
                <select [(ngModel)]="selectedIntervention.statut" name="statut" required>
                    <option value="Prévue">Prévue</option>
                    <option value="Prévue">En Attente</option>
                    <option value="En cours">En cours</option>
                    <option value="Terminée">Terminée</option>
                    <option value="Annulée">Annulée</option>
                </select>
            </div>

            <div>
                <label>Description</label>
                <textarea [(ngModel)]="selectedIntervention.description" name="description" placeholder="Détails de l’intervention"></textarea>
            </div>

            <!-- Liste des utilisateurs -->
            <div>
                <label>Utilisateur demandeur</label>
                <select [(ngModel)]="selectedIntervention.demandeur" name="demandeur" required>
                    <option *ngFor="let utilisateur of userList" [ngValue]="utilisateur">{{ utilisateur.nom }} {{ utilisateur.prenom }}</option>
                </select>
            </div>

            <!-- Liste des matériaux -->
            <div>
                <label>Matériaux</label>
                <select [(ngModel)]="selectedIntervention.materiel" name="materiel" required>
                    <option *ngFor="let materiel of MatList" [ngValue]="materiel">{{ materiel.model }}</option>
                </select>
            </div>

            <button type="submit">Mettre à jour</button>
            <button type="button" (click)="closeModalEdit()">Annuler</button>
        </form>
    </div>
</div>
<!-- Modal de Confirmation de Suppression -->
<div *ngIf="isDeleteConfirmOpen" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content bg-white dark:bg-[#0c1427] rounded p-6 w-[90%] md:w-[400px] m-auto mt-[10%]" (click)="$event.stopPropagation()">
      <h2 class="text-lg font-semibold mb-4 text-center text-black dark:text-white">Confirmation</h2>
      <p class="mb-6 text-center text-gray-700 dark:text-gray-300">Êtes-vous sûr de vouloir archiver cet intervention ?</p>
      <div class="flex justify-center gap-4">
        <button class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" (click)="confirmDeleteUser()">Oui</button>
        <button class="bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400" (click)="cancelDelete()">Non</button>
      </div>
    </div>
</div>
