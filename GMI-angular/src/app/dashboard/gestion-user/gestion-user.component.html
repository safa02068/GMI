<div class="trezo-card bg-white dark:bg-[#0c1427] mb-[25px] p-[20px] md:p-[25px] rounded-md">
  <div class="trezo-card-header mb-[20px] md:mb-[25px] sm:flex items-center justify-between">
    <div class="trezo-card-title flex items-center gap-2">
        <h3 class="mb-0 text-[#516359]">Utilisateurs</h3> 
    </div>
    <div class="trezo-card-subtitle mt-[10px] sm:mt-0 flex flex-col sm:flex-row items-center gap-3">
      <input type="text" [(ngModel)]="searchText" placeholder="Rechercher un utilisateur..."
        class="border border-gray-300 dark:border-[#172036] rounded-md px-3 py-2 w-full sm:w-auto dark:bg-[#0c1427] dark:text-white" />
      <button type="button"
        class="rounded-md inline-block transition-all py-[3.5px] px-[17px] border border-gray-100 dark:border-[#172036] hover:border-[#516359] hover:bg-[#516359] hover:text-white"
        (click)="openModaladd()">
        <i class="ri-add-line text-xl"></i> Ajouter
      </button>
    </div>
  </div>

  <div class="table-responsive overflow-x-auto">
    <table class="w-full without-border">
      <thead class="text-black dark:text-white">
        <tr>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Nom
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Prenom
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Email
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Role
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Téléphone
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Adresse
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            CIN
          </th>
          <th
            class="font-medium ltr:text-left rtl:text-right px-[20px] py-[11px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 bg-primary-50 dark:bg-[#15203c] whitespace-nowrap bg-[#EFF3F7]">
            Action
          </th>
        </tr>
      </thead>

      <tbody class="text-black dark:text-white">
        <tr *ngFor="let u of filteredUsers ">
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.nom}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.prenom}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.email}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.p}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.tel}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.adresse}}
            </span>
          </td>
          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[15px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <span class="text-gray-500 dark:text-gray-400">
              {{u?.cin}}
            </span>
          </td>

          <td
            class="ltr:text-left rtl:text-right whitespace-nowrap px-[20px] py-[17px] md:ltr:first:pl-[25px] md:rtl:first:pr-[25px] ltr:first:pr-0 rtl:first:pl-0 border-b border-gray-100 dark:border-[#172036]">
            <div class="flex items-center gap-[9px]">
              <button id="customTooltip" type="button" data-text="Modifier"
                class="text-gray-500 dark:text-gray-400 leading-none custom-tooltip" (click)="editUser(u)">
                <i class="material-symbols-outlined !text-md">
                  edit
                </i>
              </button>
              <button id="customTooltip" type="button" data-text="Supprimer"
                class="text-danger-500 leading-none custom-tooltip" (click)="confirmDelete(u)">
                <i class="material-symbols-outlined !text-md">
                  delete
                </i>
              </button>
            </div>
          </td>


        </tr>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="flex items-center justify-between mt-4">
    <div class="text-sm text-gray-500 dark:text-gray-400">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} entries
    </div>
    <div class="flex items-center space-x-2">
      <button 
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)"
        class="px-3 py-1 rounded-md border border-gray-300 dark:border-[#172036] disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-[#15203c]">
        Previous
      </button>
      <div class="flex items-center space-x-1">
        <button 
          *ngFor="let page of getPageNumbers()"
          (click)="onPageChange(page)"
          [class.bg-[#516359]]="currentPage === page"
          [class.text-white]="currentPage === page"
          class="px-3 py-1 rounded-md border border-gray-300 dark:border-[#172036] hover:bg-gray-100 dark:hover:bg-[#15203c]">
          {{ page }}
        </button>
      </div>
      <button 
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)"
        class="px-3 py-1 rounded-md border border-gray-300 dark:border-[#172036] disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-[#15203c]">
        Next
      </button>
    </div>
  </div>
</div>

<!-- Modal de Confirmation de Suppression -->
<div *ngIf="isDeleteConfirmOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="modal-content bg-white dark:bg-[#0c1427] rounded p-6 w-[90%] md:w-[400px] m-auto"
    (click)="$event.stopPropagation()">
    <h2 class="text-lg font-semibold mb-4 text-center text-black dark:text-white">Confirmation</h2>
    <p class="mb-6 text-center text-gray-700 dark:text-gray-300">Êtes-vous sûr de vouloir supprimer cet utilisateur ?
    </p>
    <div class="flex justify-center gap-4">
      <button class="bg-[#f44336] text-white px-4 py-2 rounded hover:bg-[#d32f2f]"
        (click)="confirmDeleteUser()">Oui</button>
      <button class="bg-[#548B56] text-white px-4 py-2 rounded hover:bg-[#41743f]" (click)="cancelDelete()">Non</button>
    </div>
  </div>
</div>

<!-- Modal d'ajout d'un Utilisateur -->
<div *ngIf="showModaladd" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white dark:bg-[#0c1427] w-full max-w-2xl p-[25px] rounded-md shadow-lg">
    <div class="flex items-center justify-between mb-[20px]">
      <h2 class="text-xl font-semibold text-[#516359]">Ajouter un utilisateur</h2>
      <button (click)="closeModaladd()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
    </div>
    <form (ngSubmit)="saveUser()" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="nom" class="block mb-1 font-medium">Nom</label>
          <input type="text" [(ngModel)]="newUser.nom" name="nom" id="nom" placeholder="Nom" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="prenom" class="block mb-1 font-medium">Prénom</label>
          <input type="text" [(ngModel)]="newUser.prenom" name="prenom" id="prenom" placeholder="Prénom" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="email" class="block mb-1 font-medium">Email</label>
          <input type="email" [(ngModel)]="newUser.email" name="email" id="email" placeholder="Email" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="password" class="block mb-1 font-medium">Mot de passe</label>
          <input type="password" [(ngModel)]="newUser.password" name="password" id="password" placeholder="Mot de passe" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="adresse" class="block mb-1 font-medium">Adresse</label>
          <input type="text" [(ngModel)]="newUser.adresse" name="adresse" id="adresse" placeholder="Adresse" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="tel" class="block mb-1 font-medium">Téléphone</label>
          <input type="text" [(ngModel)]="newUser.tel" name="tel" id="tel" placeholder="Tel" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="cin" class="block mb-1 font-medium">CIN</label>
          <input type="text" [(ngModel)]="newUser.cin" name="cin" id="cin" placeholder="CIN" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="p" class="block mb-1 font-medium">Rôle</label>
          <select [(ngModel)]="newUser.p" name="p" id="p" class="form-select border rounded-md p-2 w-full">
            <option value="CHEF_PROJET">CHEF_PROJET</option>
            <option value="EMPLOYE">EMPLOYE</option>
            <option value="TECHNICIEN">TECHNICIEN</option>
          </select>
        </div>
      </div>

      <div class="flex justify-end space-x-2 pt-4">
       <!--  <button type="submit"
          class="py-[10px] px-[30px] bg-primary-500 text-white transition-all hover:bg-primary-400 rounded-md border border-primary-500 hover:border-primary-400">
          Ajouter
        </button> -->
        <button type="submit"
          class="py-[10px] px-[30px] bg-[#516359] text-white transition-all hover:bg-[#43563e] rounded-md border border-[#516359] hover:border-[#43563e]">
          Ajouter
        </button>
        <button type="button" (click)="closeModaladd()"
          class="py-[10px] px-[30px] bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md border border-gray-300">
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Modification -->
<div *ngIf="isModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
  (click)="closeModal()">
  <div class="bg-white dark:bg-[#0c1427] w-full max-w-2xl p-[25px] rounded-md shadow-lg"
    (click)="$event.stopPropagation()">
    <div class="flex items-center justify-between mb-[20px]">
      <h2 class="text-xl font-semibold text-[#516359]">Modifier l'utilisateur</h2>
      <button (click)="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
    </div>

    <form (ngSubmit)="update()" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="nom-edit" class="block mb-1 font-medium">Nom</label>
          <input type="text" [(ngModel)]="selectedUser.nom" name="nom" id="nom-edit" placeholder="Nom" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="prenom-edit" class="block mb-1 font-medium">Prénom</label>
          <input type="text" [(ngModel)]="selectedUser.prenom" name="prenom" id="prenom-edit" placeholder="Prénom" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="email-edit" class="block mb-1 font-medium">Email</label>
          <input type="email" [(ngModel)]="selectedUser.email" name="email" id="email-edit" placeholder="Email" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="tel-edit" class="block mb-1 font-medium">Téléphone</label>
          <input type="text" [(ngModel)]="selectedUser.tel" name="tel" id="tel-edit" placeholder="Téléphone" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="adresse-edit" class="block mb-1 font-medium">Adresse</label>
          <input type="text" [(ngModel)]="selectedUser.adresse" name="adresse" id="adresse-edit" placeholder="Adresse" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="cin-edit" class="block mb-1 font-medium">CIN</label>
          <input type="text" [(ngModel)]="selectedUser.cin" name="cin" id="cin-edit" placeholder="CIN" required class="form-input border rounded-md p-2 w-full" />
        </div>
        <div>
          <label for="p-edit" class="block mb-1 font-medium">Rôle</label>
          <select [(ngModel)]="selectedUser.p" name="p" id="p-edit" class="form-select border rounded-md p-2 w-full">
            <option value="CHEF_PROJET">CHEF_PROJET</option>
            <option value="EMPLOYE">EMPLOYE</option>
            <option value="TECHNICIEN">TECHNICIEN</option>
          </select>
        </div>
      </div>

      <div class="flex justify-end space-x-2 pt-4">
        <button type="submit"
          class="py-[10px] px-[30px] bg-[#516359] text-white transition-all hover:bg-[#43563e] rounded-md border border-[#516359] hover:border-[#43563e]">
          Modifier
        </button>
        <button type="button" (click)="closeModal()"
          class="py-[10px] px-[30px] bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md border border-gray-300">
          Fermer
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Alert message-->
<div *ngIf="alertShow" [ngClass]="{
    'bg-success-500': alertType === 'success',
    'bg-danger-500': alertType === 'error'
}" class="fixed top-4 right-4 p-4 rounded-md text-white z-50">
    {{ alertMessage }}
</div>